<!DOCTYPE html>
<html>

    <head>
        <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" media="all" />


        <script type="text/javascript" src="//code.jquery.com/jquery-1.8.0.min.js"></script>
        <script type="text/javascript">
            $(document).ready(
                    function() {
                        sse = new EventSource('/my_event_source');
                        sse.onmessage = function(message) {
                            // console.log(message)
                            try {
                                var msg = jQuery.parseJSON(message.data)
                            } 
                            catch (e) {
                                console.log(e)
                                console.log(message.data)
                            }
                            // console.log('hi')
                            // console.log(msg.mtype)
                            if (msg.mtype == "poem") {
                                console.log(message.data)
                                // var line_array = msg.text.split('\n');
                                $('#poem-container').html ( msg.body.map(function(line) {
                                    return '<div class="poem-line"><a class="line-link" href="https://www.twitter.com/user/status/'+line.info.id_str+'">'+line.info.text+'</a></div>'
                                }).reduce(function(a, b) {
                                    return a + b
                                }) 
                                )
                                console.log(msg.body)
                               // $('#output').append('<li>'+msg.text+'</li>');
                            // } else if (msg.mtype == "item") {
                            //     $('#line').html( msg.text )
                            } else if (msg.mtype == "line") {
                                $('#last-line').html( msg.body )
                            }
                            // console.log('A message has arrived!');
                         
                        }
                    })
        </script>
    </head>

    <body>

        <h2>Demo</h2>
        <div id="left">
        <p id="last-line"></p>
        <div id="poem-container">
        </div>
        </div>
        <div id="right">

        </div>
        <!-- <ul id="output">

        </ul> -->

    </body>

</html>